{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.14.2/.schema/devbox.schema.json",
  "packages": [
    "python313@latest",
    "uv@0.8.2",
    "tailwindcss_4@4.1.11",
    "process-compose@latest",
    "postgresql@latest",
    "ruff@latest"
  ],
  "env": {},
  "shell": {
    "init_hook": [
      ". $VENV_DIR/bin/activate",
      "echo Running uv sync...",
      "uv sync --group dev"
    ],
    "scripts": {
      "server": [
        "python manage.py runserver"
      ],
      "static": [
        "python manage.py collectstatic"
      ],
      "create_db": [
        "echo \"Creating DB\"",
        "dropdb --if-exists $POSTGRES_DB",
        "createdb $POSTGRES_DB",
        "psql $POSTGRES_DB --command \"CREATE USER $POSTGRES_USER WITH PASSWORD '$POSTGRES_PASSWORD';\"",
        "psql $POSTGRES_DB --command \"ALTER DATABASE $POSTGRES_DB OWNER TO $POSTGRES_USER;\"",
        "psql $POSTGRES_DB --command \"ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO $POSTGRES_USER;\"",
        "devbox run migrate"
      ],
      "migrate": [
        "python manage.py makemigrations",
        "python manage.py migrate"
      ],
      "lint": [
        "ruff check"
      ],
      "test": [
        "initdb",
        "devbox services start",
        "devbox run create_db",
        "python manage.py test",
        "devbox services stop"
      ],
      "test-dockerignore": [
        "rsync -avn . /dev/shm --exclude-from .dockerignore"
      ]
    }
  }
}
